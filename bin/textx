#!/usr/bin/env python
import sys
import argparse
from textx.metamodel import metamodel_from_file
from textx.export import metamodel_export, model_export

parser = argparse.ArgumentParser(description="textX checker and visualizer")
parser.add_argument('cmd', help="Command - check or vis")
parser.add_argument('metamodel', help="Meta-model file name")
parser.add_argument('model', help="Model file name", nargs="?")

args = parser.parse_args()

if args.cmd not in ['vis', 'check']:
    print "Unknown command {}. Command must be one of 'vis', 'check'.".format(args.cmd)
    sys.exit(1)

metamodel = metamodel_from_file(args.metamodel)
print("Meta-model OK.")

if args.model:
    model = metamodel.model_from_file(args.model)
    print("Model OK.")

if args.cmd == "vis":
    print("Generating .dot file for meta-model.")
    metamodel_export(metamodel, "%s.dot" % args.metamodel)

    if args.model:
        print("Generating .dot file for model.")
        model_export(model, "%s.dot" % args.model)
